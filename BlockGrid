import { _decorator, Component, instantiate, Prefab, Vec3 } from 'cc';
import { Block } from './Block'; // <-- import Block class
const { ccclass, property } = _decorator;

@ccclass('BlockGrid')
export class BlockGrid extends Component {

    @property(Prefab)
    blockPrefab: Prefab | null = null;    // assign in inspector

    @property
    rows: number = 5;

    @property
    cols: number = 5;

    start() {
        this.generateGrid();
    }

    generateGrid() {
        if (!this.blockPrefab) return;

        const spacing = 1.2;
        // center grid around origin
        const offsetX = - (this.cols - 1) * spacing * 0.5;
        const offsetZ = - (this.rows - 1) * spacing * 0.5;

        for (let r = 0; r < this.rows; r++) {
            for (let c = 0; c < this.cols; c++) {
                const blockNode = instantiate(this.blockPrefab);
                const x = c * spacing + offsetX;
                const y = 0;
                const z = r * spacing + offsetZ;

                blockNode.setPosition(new Vec3(x, y, z));
                blockNode.setParent(this.node);

                const colorID = Math.floor(Math.random() * 4);

                // typed getComponent -> returns Block | null
                const blockComp = blockNode.getComponent(Block);
                if (blockComp) blockComp.init(colorID);
            }
        }
    }
}
